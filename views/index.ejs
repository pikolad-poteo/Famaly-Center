<%- include('layout', {
  user: user,
  body: `
    <div class="row mb-3">
      <div class="col-12">
        <h2>Дашборд</h2>
        <p class="text-muted">Привет, ${user.name || user.email}!</p>
      </div>
    </div>

    <div class="row section-card">
      <div class="col-md-4 mb-3">
        <div class="card border-0 shadow-sm">
          <div class="card-body">
            <h5 class="card-title">Текущий баланс</h5>
            <p class="card-text fs-3">
              ${Number(balance || 0).toFixed(2)} €
            </p>
          </div>
        </div>
      </div>

      <div class="col-md-4 mb-3">
        <div class="card border-0 shadow-sm">
          <div class="card-body">
            <h5 class="card-title">Доходы (текущий месяц)</h5>
            <p class="card-text fs-4 text-success">
              ${Number(income || 0).toFixed(2)} €
            </p>
          </div>
        </div>
      </div>

      <div class="col-md-4 mb-3">
        <div class="card border-0 shadow-sm">
          <div class="card-body">
            <h5 class="card-title">Расходы (текущий месяц)</h5>
            <p class="card-text fs-4 text-danger">
              ${Math.abs(Number(expense || 0)).toFixed(2)} €
            </p>
          </div>
        </div>
      </div>
    </div>

    <div class="row section-card">
      <div class="col-12">
        <div class="card border-0 shadow-sm">
          <div class="card-body">
            <h5 class="card-title">Расходы по категориям</h5>

            ${
              (!categoriesSummary || categoriesSummary.length === 0)
                ? `<p class="text-muted mb-0">За этот месяц ещё нет расходов.</p>`
                : `
                  <p class="mb-2 text-muted">
                    Общая сумма расходов: <strong>${Number(totalExpensesAbs || 0).toFixed(2)} €</strong>
                  </p>

                  <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-3">
                    ${
                      categoriesSummary.map(c => `
                        <div class="col">
                          <div class="h-100 d-flex flex-column rounded-3 p-3 shadow-sm"
                               style="background: rgba(0,0,0,0.02); border-left: 4px solid ${c.color};">
                            <div class="d-flex align-items-center mb-2">
                              <div class="rounded-circle d-flex align-items-center justify-content-center me-2"
                                   style="width:32px;height:32px;background:${c.color};">
                                <i class="bi ${c.icon} text-white"></i>
                              </div>
                              <div class="flex-grow-1">
                                <div class="small fw-semibold">${c.name}</div>
                                <div class="small text-muted">${c.percent.toFixed(1)}% от расходов</div>
                              </div>
                            </div>

                            <div class="mt-auto d-flex justify-content-between align-items-end">
                              <div class="fw-semibold">
                                ${c.total.toFixed(2)} €
                              </div>
                            </div>
                          </div>
                        </div>
                      `).join('')
                    }
                  </div>
                `
            }
          </div>
        </div>
      </div>
    </div>

    <div class="row section-card">
      <div class="col-md-6 mb-3">
        <a href="/transactions" class="btn btn-primary w-100">Перейти к транзакциям</a>
      </div>

      <div class="col-md-6 mb-3">
        <div class="card border-danger">
          <div class="card-body">
            <h5 class="card-title text-danger">Опасная зона</h5>
            <p class="card-text small text-muted">
              Эта кнопка удалит <strong>все транзакции</strong> и <strong>все ваши категории</strong> в рамках текущей семьи.
              Базовые категории (по умолчанию) останутся. Действие нельзя отменить.
            </p>
            <form method="POST" action="/reset-data"
                  onsubmit="return confirm('Точно удалить все данные (кроме базовых категорий)? Это действие нельзя отменить.');">
              <button type="submit" class="btn btn-outline-danger w-100">
                Очистить все данные семьи
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>
  `
}) %>

