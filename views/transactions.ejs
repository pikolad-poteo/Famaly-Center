<%- include('layout', {
  user: user,
  body: `
    <h2 class="mb-3">Транзакции</h2>

    <div class="row">
      <div class="col-md-6 mb-4">
        <div class="card border-0 shadow-sm">
          <div class="card-body">
            <h5 class="card-title">Добавить транзакцию</h5>
            <form method="POST" action="/transactions">
              <div class="mb-3">
                <label class="form-label">Дата</label>
                <input type="date" class="form-control" name="date" value="${new Date().toISOString().slice(0,10)}" required>
              </div>

              <div class="mb-3">
                <label class="form-label">Тип</label>
                <select name="type" class="form-select">
                  <option value="expense">Расход</option>
                  <option value="income">Доход</option>
                </select>
              </div>

              <div class="mb-3">
                <label class="form-label">Кто платил</label>
                <select name="who" class="form-select">
                  <option value="me">Я</option>
                  <option value="girlfriend">Девушка</option>
                  <option value="shared">Общая</option>
                </select>
              </div>

              <div class="mb-3">
                <label class="form-label">Сумма (€)</label>
                <input type="number" step="0.01" name="amount" class="form-control" required>
              </div>

              <div class="mb-3">
                <label class="form-label">Категория</label>
                <select name="category_id" class="form-select" required>
                  ${categories.map(c => `
                    <option value="${c.id}">${c.name}</option>
                  `).join('')}
                </select>
              </div>

              <div class="mb-3">
                <label class="form-label">Описание</label>
                <input type="text" name="description" class="form-control" placeholder="Комментарий">
              </div>

              <button type="submit" class="btn btn-primary">Добавить</button>
            </form>
          </div>
        </div>
      </div>

      <div class="col-md-6 mb-4">
        <div class="card border-0 shadow-sm">
          <div class="card-body">
            <h5 class="card-title">Фильтры</h5>
            <form method="GET" action="/transactions">
              <div class="mb-3">
                <label class="form-label">С даты</label>
                <input type="date" name="from" value="${filters.from}" class="form-control">
              </div>

              <div class="mb-3">
                <label class="form-label">По дату</label>
                <input type="date" name="to" value="${filters.to}" class="form-control">
              </div>

              <div class="mb-3">
                <label class="form-label">Категория</label>
                <select name="category_id" class="form-select">
                  <option value="all"${filters.category_id === 'all' ? ' selected' : ''}>Все</option>
                  ${categories.map(c => `
                    <option value="${c.id}" ${String(filters.category_id) === String(c.id) ? 'selected' : ''}>${c.name}</option>
                  `).join('')}
                </select>
              </div>

              <button type="submit" class="btn btn-outline-primary">Применить</button>
            </form>
          </div>
        </div>
      </div>
    </div>

    <div class="row section-card">
      <div class="col-12">
        <div class="card border-0 shadow-sm">
          <div class="card-body">
            <h5 class="card-title">Список транзакций</h5>

            ${
              transactions.length === 0
                ? `<p class="text-muted mb-0">Транзакций пока нет.</p>`
                : `
                  <div class="table-responsive">
                    <table class="table table-sm align-middle">
                      <thead class="table-light">
                        <tr>
                          <th>Дата</th>
                          <th>Категория</th>
                          <th>Описание</th>
                          <th>Кто</th>
                          <th class="text-end">Сумма</th>
                        </tr>
                      </thead>
                      <tbody>
                        ${transactions.map(t => `
                          <tr>
                            <td>${String(t.date).slice(0,10)}</td>
                            <td>${t.category_name}</td>
                            <td>${t.description || ''}</td>
                            <td>
                              ${
                                t.who === 'me'
                                  ? 'Я'
                                  : t.who === 'girlfriend'
                                  ? 'Девушка'
                                  : 'Общая'
                              }
                            </td>
                            <td class="text-end ${t.amount < 0 ? 'text-danger' : 'text-success'}">
                              ${Number(t.amount).toFixed(2)} €
                            </td>
                          </tr>
                        `).join('')}
                      </tbody>
                    </table>
                  </div>
                `
            }
          </div>
        </div>
      </div>
    </div>
  `
}) %>
